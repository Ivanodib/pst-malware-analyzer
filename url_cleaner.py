from distutils.command.clean import clean
from operator import contains
from urlextract import URLExtract
from urllib.parse import unquote
import re


def pulizia_url (url):
    clean_url = unquote(url)
    clean_url = clean_url.replace('<','' ) 

    reg = r"https?:\/\/(?:www\.)?([-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b)*(\/[\/\d\w\.-]*)*(?:[\?])*(.+)*"

    if "?url=" in clean_url:
        remove_safe = clean_url.split("?url=")
        new_url = re.match(reg,remove_safe[1])
        return new_url.group(1)

    if "@" in clean_url:
        remove_at = clean_url.split("@")
        return remove_at[1]

    

raw_url = "https://eur04.safelinks.protection.outlook.com/?url=http://go.microsoft.com/fwlink/p/?LinkID=512132&data=04|01|ivano.dibenedetto@brightcyde.com|825dfa56ffee457a394e08da15a51f77|c187ee014e4e40c8b342f82c8d699421|0|0|637846096195474452|Unknown|TWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0=|3000&sdata=bjEdwfYleihuyRlwZG/BCQIgzJy2FGk0Tz/M4YwA23g=&reserved=0"
print(pulizia_url(raw_url))